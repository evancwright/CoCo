                      (      FLOODIT.ASM):00001         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00002         ;FLOOD-IT FOR TRS-80 COCO MODEL 2
                      (      FLOODIT.ASM):00003         ;EVAN C. WRIGHT, 2016
                      (      FLOODIT.ASM):00004         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     A1CB             (      FLOODIT.ASM):00005         KBSCAN  EQU $A1CB
     05E0             (      FLOODIT.ASM):00006         LAST_LINE EQU 1504 
     0600             (      FLOODIT.ASM):00007         VRAM_END EQU (1024+512)
     0003             (      FLOODIT.ASM):00008         KEY_ESC EQU 3
     0042             (      FLOODIT.ASM):00009         KEY_B EQU 66
     0044             (      FLOODIT.ASM):00010         KEY_D EQU 68
     0045             (      FLOODIT.ASM):00011         KEY_E EQU 69
     0047             (      FLOODIT.ASM):00012         KEY_G EQU 71
     0048             (      FLOODIT.ASM):00013         KEY_H EQU 72
     0049             (      FLOODIT.ASM):00014         KEY_I EQU 73
     004C             (      FLOODIT.ASM):00015         KEY_L EQU 76
     0050             (      FLOODIT.ASM):00016         KEY_P EQU 80
     0051             (      FLOODIT.ASM):00017         KEY_Q EQU 81
     0052             (      FLOODIT.ASM):00018         KEY_R EQU 82
     0054             (      FLOODIT.ASM):00019         KEY_T EQU 84
     0055             (      FLOODIT.ASM):00020         KEY_U EQU 85
     0057             (      FLOODIT.ASM):00021         KEY_W EQU 87
     0058             (      FLOODIT.ASM):00022         KEY_X EQU 88
     0059             (      FLOODIT.ASM):00023         KEY_Y EQU 89
     0032             (      FLOODIT.ASM):00024         KEY_2 EQU 50
     0035             (      FLOODIT.ASM):00025         KEY_5 EQU 53
     003D             (      FLOODIT.ASM):00026         KEY_EQUALS EQU 61
     002F             (      FLOODIT.ASM):00027         KEY_SLASH EQU 47
     0060             (      FLOODIT.ASM):00028         GREEN EQU 96
     0020             (      FLOODIT.ASM):00029         DARK_GREEN EQU 32
     0080             (      FLOODIT.ASM):00030         BLACK EQU 128
     00CF             (      FLOODIT.ASM):00031         WHITE EQU 207
     009F             (      FLOODIT.ASM):00032         YELLOW EQU 159
     00AF             (      FLOODIT.ASM):00033         BLUE EQU 175
     00DF             (      FLOODIT.ASM):00034         LIGHT_BLUE EQU 223
     00BF             (      FLOODIT.ASM):00035         RED EQU 191
     0400             (      FLOODIT.ASM):00036         VRAM EQU 1024
     0032             (      FLOODIT.ASM):00037         MAX_TURNS EQU 50
                      (      FLOODIT.ASM):00038         ;PROG_LENGTH set END_DATA-START_DATA
                      (      FLOODIT.ASM):00039                 
                      (      FLOODIT.ASM):00040                 ; .BIN FILE HEADER
                      (      FLOODIT.ASM):00041         ;       .db 0x00        ;
                      (      FLOODIT.ASM):00042         ;       .dw PROG_LENGTH
                      (      FLOODIT.ASM):00043         ;       .db 0x0E        ; address to load prog into
                      (      FLOODIT.ASM):00044         ;       .db 0x00
                      (      FLOODIT.ASM):00045         
                      (      FLOODIT.ASM):00046                 ORG 0x0E00 ; START CODE HERE
0E00                  (      FLOODIT.ASM):00047         START
                      (      FLOODIT.ASM):00048         ;START_DATA: 
0E00 CE7FFF           (      FLOODIT.ASM):00049                 LDU #0x7FFF ; setup user stack
0E03 7F1084           (      FLOODIT.ASM):00050                 CLR TURNS       ; SET TURNS TO 0        
0E06 9680             (      FLOODIT.ASM):00051                 LDA BLACK
0E08 B71083           (      FLOODIT.ASM):00052                 STA CLR_COLOR
0E0B 108E148B         (      FLOODIT.ASM):00053                 LDY #SCREEN_BUFFER_2    ; CLEAR BUFFER 2
0E0F BD0F33           (      FLOODIT.ASM):00054                 JSR CLS
                      (      FLOODIT.ASM):00055                 ; set user stack to top of user ram
                      (      FLOODIT.ASM):00056         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00057         ; LOOP TO FILL THE SCREEN WITH ALL 'A' CHARS
                      (      FLOODIT.ASM):00058         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0E12 CC0000           (      FLOODIT.ASM):00059                 LDD #0          ; loop counter
0E15 108E0400         (      FLOODIT.ASM):00060                 LDY #1024       ; load addr to copy to
0E19                  (      FLOODIT.ASM):00061         fill_loop_top:
0E19 3406             (      FLOODIT.ASM):00062                 PSHS D          ; save A (loop counter)
0E1B BD0EB6           (      FLOODIT.ASM):00063                 JSR RND5        ;GET RND COLOR
0E1E BE107E           (      FLOODIT.ASM):00064                 LDX NEXTFIB-1
0E21 A6891076         (      FLOODIT.ASM):00065                 LDA COLORS,X
0E25 A7A0             (      FLOODIT.ASM):00066                 STA ,Y+ ; copy char to location stored in Y increment Y
0E27 3506             (      FLOODIT.ASM):00067                 PULS D  ; restore A (loop counter)
0E29 C30001           (      FLOODIT.ASM):00068                 ADDD    #1 ; increment loop counter
0E2C 108301E0         (      FLOODIT.ASM):00069                 CMPD #480       ; done (hit bottom of screen)?
0E30 26E7             (      FLOODIT.ASM):00070                 BNE fill_loop_top
0E32 BD0EE0           (      FLOODIT.ASM):00071                 JSR DRAW_LEGEND
0E35 BD0EEB           (      FLOODIT.ASM):00072                 JSR DRAW_INSTRUCTIONS ; DRAWS OFFSCREEN
0E38                  (      FLOODIT.ASM):00073         KB_LOOP:
0E38 BDA1CB           (      FLOODIT.ASM):00074                 JSR KBSCAN  ; PUTS KEYCODE INTO A - 0 = NO KEY
0E3B 9100             (      FLOODIT.ASM):00075                 CMPA 0  
0E3D 27F9             (      FLOODIT.ASM):00076                 BEQ KB_LOOP     ; IF 0 (NO KEY), REPEAT LOOP
                      (      FLOODIT.ASM):00077                 ;KEY WAS PRESSED
0E3F 8103             (      FLOODIT.ASM):00078                 CMPA #KEY_ESC
0E41 2767             (      FLOODIT.ASM):00079                 BEQ DONE
0E43 8148             (      FLOODIT.ASM):00080                 CMPA #KEY_H
0E45 2609             (      FLOODIT.ASM):00081                 BNE @a
0E47 108E128B         (      FLOODIT.ASM):00082                 LDY #SCREEN_BUFFER
0E4B BD102A           (      FLOODIT.ASM):00083                 JSR SWITCH_BUFFERS
0E4E 20E8             (      FLOODIT.ASM):00084                 BRA KB_LOOP
0E50 8142             (      FLOODIT.ASM):00085         @a      CMPA #KEY_B
0E52 260A             (      FLOODIT.ASM):00086                 BNE @b
0E54 86AF             (      FLOODIT.ASM):00087                 LDA #BLUE
0E56 B71082           (      FLOODIT.ASM):00088                 STA NEW_COLOR   ; B KEY 
0E59 BD0F49           (      FLOODIT.ASM):00089                 JSR START_FILL
0E5C 20DA             (      FLOODIT.ASM):00090                 BRA KB_LOOP
0E5E 8159             (      FLOODIT.ASM):00091         @b      CMPA #KEY_Y             ; Y KEY - YELLOW
0E60 260A             (      FLOODIT.ASM):00092                 BNE @c
0E62 869F             (      FLOODIT.ASM):00093                 LDA #YELLOW
0E64 B71082           (      FLOODIT.ASM):00094                 STA NEW_COLOR   
0E67 BD0F49           (      FLOODIT.ASM):00095                 JSR START_FILL
0E6A 20CC             (      FLOODIT.ASM):00096                 BRA KB_LOOP
0E6C 8157             (      FLOODIT.ASM):00097         @c      CMPA #KEY_W             ; W KEY - WHITE
0E6E 260A             (      FLOODIT.ASM):00098                 BNE @d
0E70 86CF             (      FLOODIT.ASM):00099                 LDA #WHITE
0E72 B71082           (      FLOODIT.ASM):00100                 STA NEW_COLOR
0E75 BD0F49           (      FLOODIT.ASM):00101                 JSR START_FILL
0E78 20BE             (      FLOODIT.ASM):00102                 BRA KB_LOOP
0E7A 8152             (      FLOODIT.ASM):00103         @d      CMPA #KEY_R             ; R RED
0E7C 260B             (      FLOODIT.ASM):00104                 BNE @e
0E7E 86BF             (      FLOODIT.ASM):00105                 LDA #RED
0E80 B71082           (      FLOODIT.ASM):00106                 STA NEW_COLOR   ; R KEY 
0E83 BD0F49           (      FLOODIT.ASM):00107                 JSR START_FILL
0E86 7E0E38           (      FLOODIT.ASM):00108                 JMP KB_LOOP
0E89 8147             (      FLOODIT.ASM):00109         @e      CMPA #KEY_G     ; X KEY 
0E8B 260B             (      FLOODIT.ASM):00110                 BNE @f
0E8D 8660             (      FLOODIT.ASM):00111                 LDA #GREEN
0E8F B71082           (      FLOODIT.ASM):00112                 STA NEW_COLOR   
0E92 BD0F49           (      FLOODIT.ASM):00113                 JSR START_FILL
0E95 7E0E38           (      FLOODIT.ASM):00114                 JMP KB_LOOP     
0E98 8158             (      FLOODIT.ASM):00115         @f      CMPA #KEY_X     ; X KEY 
0E9A 260B             (      FLOODIT.ASM):00116                 BNE @g
0E9C 8680             (      FLOODIT.ASM):00117                 LDA #BLACK
0E9E B71082           (      FLOODIT.ASM):00118                 STA NEW_COLOR   
0EA1 BD0F49           (      FLOODIT.ASM):00119                 JSR START_FILL
0EA4 7E0E38           (      FLOODIT.ASM):00120                 JMP KB_LOOP     
0EA7 7E0E38           (      FLOODIT.ASM):00121         @g      JMP KB_LOOP
0EAA                  (      FLOODIT.ASM):00122         DONE:   
0EAA 8660             (      FLOODIT.ASM):00123                 LDA #GREEN
0EAC B71083           (      FLOODIT.ASM):00124                 STA CLR_COLOR
0EAF 8E0400           (      FLOODIT.ASM):00125                 LDX #VRAM
0EB2 BD0F33           (      FLOODIT.ASM):00126                 JSR CLS
0EB5 39               (      FLOODIT.ASM):00127                 RTS ; return
                      (      FLOODIT.ASM):00128         
                      (      FLOODIT.ASM):00129         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00130         ;PUTS THE NEXT FIBONACCI NUMBER IN A AND NEXTFIB
                      (      FLOODIT.ASM):00131         ;NO REGISTERS AFFECTED
                      (      FLOODIT.ASM):00132         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0EB6                  (      FLOODIT.ASM):00133         RND5:
0EB6 3402             (      FLOODIT.ASM):00134                 PSHS A
                      (      FLOODIT.ASM):00135                 ;COMPUTE NEXT
0EB8 B6107C           (      FLOODIT.ASM):00136                 LDA FIB1
0EBB BB107D           (      FLOODIT.ASM):00137                 ADDA FIB2
0EBE B7107F           (      FLOODIT.ASM):00138                 STA NEXTFIB
                      (      FLOODIT.ASM):00139                 ;SHIFT 2 INTO 1
0EC1 B6107D           (      FLOODIT.ASM):00140                 LDA FIB2
0EC4 B7107C           (      FLOODIT.ASM):00141                 STA FIB1
                      (      FLOODIT.ASM):00142                 ;SHIFT NEW INTO 2
0EC7 B6107F           (      FLOODIT.ASM):00143                 LDA NEXTFIB
0ECA B7107D           (      FLOODIT.ASM):00144                 STA FIB2
                      (      FLOODIT.ASM):00145                 ;MASK OF LEFT BITS
                      (      FLOODIT.ASM):00146         ;       ANDA RNDMASK
0ECD 8100             (      FLOODIT.ASM):00147                 CMPA #0
0ECF 2C01             (      FLOODIT.ASM):00148                 BGE MODLOOP
0ED1 40               (      FLOODIT.ASM):00149                 NEGA    ; flip to pos
0ED2                  (      FLOODIT.ASM):00150         MODLOOP:
0ED2 8106             (      FLOODIT.ASM):00151                 CMPA #6
0ED4 2B04             (      FLOODIT.ASM):00152                 BMI RNDDONE
0ED6 8006             (      FLOODIT.ASM):00153                 SUBA #6 ; SUBTRACT 5 OFF TO PUT NUMBER IN RANGE
0ED8 20F8             (      FLOODIT.ASM):00154                 BRA MODLOOP
0EDA                  (      FLOODIT.ASM):00155         RNDDONE:
0EDA B7107F           (      FLOODIT.ASM):00156                 STA NEXTFIB     
0EDD 3502             (      FLOODIT.ASM):00157                 PULS A
0EDF 39               (      FLOODIT.ASM):00158                 RTS
                      (      FLOODIT.ASM):00159                 
                      (      FLOODIT.ASM):00160         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00161         ;DRAW_LEGEND
                      (      FLOODIT.ASM):00162         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0EE0                  (      FLOODIT.ASM):00163         DRAW_LEGEND:
0EE0 8E108A           (      FLOODIT.ASM):00164                 LDX #LEGEND
0EE3 108E05E0         (      FLOODIT.ASM):00165                 LDY #LAST_LINE
0EE7 BD1067           (      FLOODIT.ASM):00166                 JSR STRCPY
0EEA 39               (      FLOODIT.ASM):00167                 RTS
                      (      FLOODIT.ASM):00168         
                      (      FLOODIT.ASM):00169                 
                      (      FLOODIT.ASM):00170         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00171         ;DRAW_INSTRUCTIONS TO THE OFFSCREEN BUFFER
                      (      FLOODIT.ASM):00172         ;THIS IS CALLED ON START TO DRAW THE OFFSCREEN 
                      (      FLOODIT.ASM):00173         ;HELP PAGE
                      (      FLOODIT.ASM):00174         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0EEB                  (      FLOODIT.ASM):00175         DRAW_INSTRUCTIONS:
0EEB 8680             (      FLOODIT.ASM):00176                 LDA #BLACK
0EED B71083           (      FLOODIT.ASM):00177                 STA CLR_COLOR
0EF0 8E128B           (      FLOODIT.ASM):00178                 LDX #SCREEN_BUFFER
0EF3 BD0F33           (      FLOODIT.ASM):00179                 JSR  CLS
0EF6 8E168B           (      FLOODIT.ASM):00180                 LDX #INSTRUCTIONS1
0EF9 108E128B         (      FLOODIT.ASM):00181                 LDY #SCREEN_BUFFER
0EFD BD1067           (      FLOODIT.ASM):00182                 JSR STRCPY
0F00 8E16A9           (      FLOODIT.ASM):00183                 LDX #INSTRUCTIONS2
0F03 108E12AB         (      FLOODIT.ASM):00184                 LDY #SCREEN_BUFFER+32
0F07 BD1067           (      FLOODIT.ASM):00185                 JSR STRCPY
0F0A 8E16C8           (      FLOODIT.ASM):00186                 LDX #INSTRUCTIONS3
0F0D 108E12CB         (      FLOODIT.ASM):00187                 LDY #SCREEN_BUFFER+64
0F11 BD1067           (      FLOODIT.ASM):00188                 JSR STRCPY
0F14 8E16E1           (      FLOODIT.ASM):00189                 LDX #INSTRUCTIONS4
0F17 108E12EB         (      FLOODIT.ASM):00190                 LDY #SCREEN_BUFFER+96
0F1B BD1067           (      FLOODIT.ASM):00191                 JSR STRCPY
0F1E 8E16FD           (      FLOODIT.ASM):00192                 LDX #INSTRUCTIONS5
0F21 108E130B         (      FLOODIT.ASM):00193                 LDY #SCREEN_BUFFER+128
0F25 BD1067           (      FLOODIT.ASM):00194                 JSR STRCPY
0F28 8E171C           (      FLOODIT.ASM):00195                 LDX #INSTRUCTIONS6
0F2B 108E132B         (      FLOODIT.ASM):00196                 LDY #SCREEN_BUFFER+160
0F2F BD1067           (      FLOODIT.ASM):00197                 JSR STRCPY
0F32 39               (      FLOODIT.ASM):00198                 RTS
                      (      FLOODIT.ASM):00199                 
                      (      FLOODIT.ASM):00200         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00201         ;CLS
                      (      FLOODIT.ASM):00202         ;CLEARS SCREEN WITH COLOR STORED IN CLR_COLOR
                      (      FLOODIT.ASM):00203         ;X CONTANS ADDR TO CLEAR
                      (      FLOODIT.ASM):00204         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0F33                  (      FLOODIT.ASM):00205         CLS:
0F33 3436             (      FLOODIT.ASM):00206                 PSHS D,X,Y  ; SAVE REGISTERS
0F35 108E0000         (      FLOODIT.ASM):00207                 LDY #0
0F39 B61083           (      FLOODIT.ASM):00208         @a      LDA CLR_COLOR   
0F3C A780             (      FLOODIT.ASM):00209                 STA ,X+
0F3E A6A0             (      FLOODIT.ASM):00210                 LDA     ,Y+
0F40 108C0200         (      FLOODIT.ASM):00211                 CMPY #512  ; bottom of screen mem
0F44 26F3             (      FLOODIT.ASM):00212                 BNE @a
0F46 3536             (      FLOODIT.ASM):00213                 PULS Y,X,D  ; RESTORE REGISTERS
0F48 39               (      FLOODIT.ASM):00214                 RTS
                      (      FLOODIT.ASM):00215         
                      (      FLOODIT.ASM):00216         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00217         ;START_FILL
                      (      FLOODIT.ASM):00218         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0F49                  (      FLOODIT.ASM):00219         START_FILL:
0F49 7C1084           (      FLOODIT.ASM):00220                 INC TURNS
0F4C BD0FED           (      FLOODIT.ASM):00221                 JSR CLEAR_FLAGS
                      (      FLOODIT.ASM):00222                 ;SAVE THE ORIGNAL COLOR
0F4F B60400           (      FLOODIT.ASM):00223                 LDA VRAM
0F52 B71081           (      FLOODIT.ASM):00224                 STA OLD_COLOR
                      (      FLOODIT.ASM):00225                 ;MAKE 0,0 THE NEW COLOR
0F55 8600             (      FLOODIT.ASM):00226                 LDA #0
0F57 3602             (      FLOODIT.ASM):00227                 PSHU A
0F59 3602             (      FLOODIT.ASM):00228                 PSHU A
0F5B BD0F6B           (      FLOODIT.ASM):00229                 JSR BUCKET_FILL
0F5E BD1001           (      FLOODIT.ASM):00230                 JSR CHECK_WIN
0F61 3702             (      FLOODIT.ASM):00231                 PULU A  ; GET RETURN CODE
0F63 8101             (      FLOODIT.ASM):00232                 CMPA #1
0F65 2603             (      FLOODIT.ASM):00233                 BNE @no
0F67 BD1049           (      FLOODIT.ASM):00234                 JSR PLAY_WIN_SND        ;  PLAY VICTORY MUSIC
0F6A 39               (      FLOODIT.ASM):00235         @no     RTS
                      (      FLOODIT.ASM):00236         
                      (      FLOODIT.ASM):00237         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00238         ;BUCKET_FILL
                      (      FLOODIT.ASM):00239         ;IF SQUARE IS INBOUNDS AND NOT MARKED AND
                      (      FLOODIT.ASM):00240         ;COLOR OF SQUARE IS EQUAL TO OLD COLOR,
                      (      FLOODIT.ASM):00241         ;MAKE IT THE NEW COLOR AND BUCKET FILL THE
                      (      FLOODIT.ASM):00242         ;SUROUNDING SQUARES
                      (      FLOODIT.ASM):00243         ;THE X,Y COORD OF THE SQUARE TO FILL IS 
                      (      FLOODIT.ASM):00244         ;PASSED ON THE USER STACK
                      (      FLOODIT.ASM):00245         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0F6B                  (      FLOODIT.ASM):00246         BUCKET_FILL:
                      (      FLOODIT.ASM):00247                 ;GET THE SQUARE TO CLEAR
0F6B 3702             (      FLOODIT.ASM):00248                 PULU A 
0F6D B71089           (      FLOODIT.ASM):00249                 STA Y_COORD
0F70 3702             (      FLOODIT.ASM):00250                 PULU A
0F72 B71088           (      FLOODIT.ASM):00251                 STA X_COORD
                      (      FLOODIT.ASM):00252                 ;SEE IF X,Y ARE ON THE BOARD    
0F75 81FF             (      FLOODIT.ASM):00253                 CMPA #0xFF      ; -1
0F77 2773             (      FLOODIT.ASM):00254                 BEQ @x
0F79 8120             (      FLOODIT.ASM):00255                 CMPA #32        ; OFF RIGHT EDGE        
0F7B 276F             (      FLOODIT.ASM):00256                 BEQ @x
0F7D B61089           (      FLOODIT.ASM):00257                 LDA Y_COORD
0F80 81FF             (      FLOODIT.ASM):00258                 CMPA #0xFF      ; -1
0F82 2768             (      FLOODIT.ASM):00259                 BEQ @x          ;OFF TOP
0F84 810F             (      FLOODIT.ASM):00260                 CMPA #15        ; BOTTOM ROW
0F86 2764             (      FLOODIT.ASM):00261                 BEQ @x          ;OFF BOTTOM
                      (      FLOODIT.ASM):00262                 ;SEE IF IT'S BEEN MARKED ALREADY
0F88 8620             (      FLOODIT.ASM):00263                 LDA #32
0F8A F61089           (      FLOODIT.ASM):00264                 LDB Y_COORD
0F8D 3D               (      FLOODIT.ASM):00265                 MUL
0F8E FB1088           (      FLOODIT.ASM):00266                 ADDB X_COORD
0F91 2401             (      FLOODIT.ASM):00267                 BCC @nc ; NO CARRY
0F93 4C               (      FLOODIT.ASM):00268                 INCA    ; ADD CARRY TO A
                      (      FLOODIT.ASM):00269                 ;D NOW CONTAINS THE OFFSET OF THE FLAG
0F94 1F01             (      FLOODIT.ASM):00270         @nc     TFR D,X
0F96 A68910AB         (      FLOODIT.ASM):00271                 LDA FLAGS,X
0F9A 8101             (      FLOODIT.ASM):00272                 CMPA #1 ; ALREADY MARKED?
0F9C 274E             (      FLOODIT.ASM):00273                 BEQ @x  ; BAIL IF ALREADY MARKED
                      (      FLOODIT.ASM):00274                 ;IS THE COLOR OF THIS SQUARE EQUAL TO THE OLD_COLOR?
0F9E A6890400         (      FLOODIT.ASM):00275                 LDA VRAM,X
0FA2 B11081           (      FLOODIT.ASM):00276                 CMPA OLD_COLOR
0FA5 2645             (      FLOODIT.ASM):00277                 BNE @x
                      (      FLOODIT.ASM):00278                 ;MAKE IT THE NEW COLOR
0FA7 B61082           (      FLOODIT.ASM):00279                 LDA NEW_COLOR
0FAA A7890400         (      FLOODIT.ASM):00280                 STA VRAM,X
                      (      FLOODIT.ASM):00281                 ;MARK THE SQUARE
0FAE 8601             (      FLOODIT.ASM):00282                 LDA #1
0FB0 A78910AB         (      FLOODIT.ASM):00283                 STA FLAGS,X
                      (      FLOODIT.ASM):00284                 ;BUCKET FILL THE FOUR SURROUNDING SQUARES
                      (      FLOODIT.ASM):00285                 ; FILL RIGHT (X+1,Y)
0FB4 B61088           (      FLOODIT.ASM):00286                 LDA X_COORD
0FB7 4C               (      FLOODIT.ASM):00287                 INCA
0FB8 3602             (      FLOODIT.ASM):00288                 PSHU A
0FBA B61089           (      FLOODIT.ASM):00289                 LDA     Y_COORD
0FBD 3602             (      FLOODIT.ASM):00290                 PSHU A
0FBF BD0F6B           (      FLOODIT.ASM):00291                 JSR BUCKET_FILL 
                      (      FLOODIT.ASM):00292                 ; FILL LEFT (X-1,Y)
0FC2 B61088           (      FLOODIT.ASM):00293                 LDA X_COORD
0FC5 4A               (      FLOODIT.ASM):00294                 DECA
0FC6 3602             (      FLOODIT.ASM):00295                 PSHU A
0FC8 B61089           (      FLOODIT.ASM):00296                 LDA     Y_COORD
0FCB 3602             (      FLOODIT.ASM):00297                 PSHU A
0FCD BD0F6B           (      FLOODIT.ASM):00298                 JSR BUCKET_FILL 
                      (      FLOODIT.ASM):00299                 ; FILL UP  (X,Y-1)
0FD0 B61088           (      FLOODIT.ASM):00300                 LDA X_COORD
0FD3 3602             (      FLOODIT.ASM):00301                 PSHU A
0FD5 B61089           (      FLOODIT.ASM):00302                 LDA Y_COORD     
0FD8 4C               (      FLOODIT.ASM):00303                 INCA 
0FD9 3602             (      FLOODIT.ASM):00304                 PSHU A
0FDB BD0F6B           (      FLOODIT.ASM):00305                 JSR BUCKET_FILL
                      (      FLOODIT.ASM):00306                 ; FILL DOWN
0FDE B61088           (      FLOODIT.ASM):00307                 LDA X_COORD
0FE1 3602             (      FLOODIT.ASM):00308                 PSHU A
0FE3 B61089           (      FLOODIT.ASM):00309                 LDA Y_COORD     
0FE6 4A               (      FLOODIT.ASM):00310                 DECA 
0FE7 3602             (      FLOODIT.ASM):00311                 PSHU A
0FE9 BD0F6B           (      FLOODIT.ASM):00312                 JSR BUCKET_FILL
0FEC 39               (      FLOODIT.ASM):00313         @x      RTS
                      (      FLOODIT.ASM):00314                 
                      (      FLOODIT.ASM):00315         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00316         ; CLEAR_FLAGS
                      (      FLOODIT.ASM):00317         ; SETS EACH OF THE 60 FLAG BYTES TO 0
                      (      FLOODIT.ASM):00318         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0FED                  (      FLOODIT.ASM):00319         CLEAR_FLAGS:
0FED 108E0000         (      FLOODIT.ASM):00320                 LDY #0          ;loop counter
0FF1 8E10AB           (      FLOODIT.ASM):00321                 LDX #FLAGS      ;start addr
0FF4 9600             (      FLOODIT.ASM):00322         @a      LDA 0
0FF6 A780             (      FLOODIT.ASM):00323                 STA ,X+         ;clear the byte
0FF8 A6A0             (      FLOODIT.ASM):00324                 LDA ,Y+         ;inc loop counter (clobbers a)
0FFA 108C01E0         (      FLOODIT.ASM):00325                 CMPY #480
0FFE 26F4             (      FLOODIT.ASM):00326                 BNE @a
1000 39               (      FLOODIT.ASM):00327                 RTS
                      (      FLOODIT.ASM):00328         
                      (      FLOODIT.ASM):00329         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00330         ;CHECK WIN
                      (      FLOODIT.ASM):00331         ;SCAN THE SCREEN MEMORY LOOKING FOR A CHAR THAT
                      (      FLOODIT.ASM):00332         ;DOESN'T MATCH THE FIRST.  THE RESULT (0 or 1)
                      (      FLOODIT.ASM):00333         ;IS RETURNED ON THE USER STACK.
                      (      FLOODIT.ASM):00334         ;REGISTERS ARE NOT AFFECTED
                      (      FLOODIT.ASM):00335         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
1001                  (      FLOODIT.ASM):00336         CHECK_WIN:
1001 3436             (      FLOODIT.ASM):00337                 PSHS D,X,Y
1003 108E0000         (      FLOODIT.ASM):00338                 LDY #0          ; LOOP COUNTER
1007 8E0401           (      FLOODIT.ASM):00339                 LDX #VRAM+1     ;       ADDRESS OF VIDEO RAM
100A B60400           (      FLOODIT.ASM):00340                 LDA VRAM        ;       LOAD 1ST CHAR OF VRAM
100D B71085           (      FLOODIT.ASM):00341                 STA TEMP        ;       SAVE 1ST CHAR IN TEMP   
1010 A680             (      FLOODIT.ASM):00342         @lp     LDA ,X+         ;       GET CHAR FROM SCREEN_MEM
1012 B11085           (      FLOODIT.ASM):00343                 CMPA TEMP       ;       DOES IT MATCH THE 1ST CHAR
1015 260C             (      FLOODIT.ASM):00344                 BNE @no         ;       FOUND A CHAR THAT DIDN'T MATCH THE FIRST
1017 A6A0             (      FLOODIT.ASM):00345                 LDA ,Y+         ;       INC LP COUNTER
1019 108C01E0         (      FLOODIT.ASM):00346                 CMPY #480       ;       HIT END?
101D 26F1             (      FLOODIT.ASM):00347                 BNE @lp         ;       LOOP
101F 8601             (      FLOODIT.ASM):00348                 LDA #1          ;       IF GOT HERE, LOOP DONE, ALL CHARS ON SCRN ARE THE SAME          
1021 2002             (      FLOODIT.ASM):00349                 BRA @r  ;       DONE
1023 8600             (      FLOODIT.ASM):00350         @no     LDA #0  ; 0 = NOT FOUND
1025 3602             (      FLOODIT.ASM):00351         @r      PSHU A
1027 3536             (      FLOODIT.ASM):00352                 PULS Y,X,D
1029 39               (      FLOODIT.ASM):00353                 RTS
                      (      FLOODIT.ASM):00354         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00355         ; SWITCH_BUFFERS
                      (      FLOODIT.ASM):00356         ; THIS ROUTINE COPIES THE SCREEN MEMORY INTO
                      (      FLOODIT.ASM):00357         ; GRAPHICS BUFFER 1. THIS IS REQUIRED PRIOR
                      (      FLOODIT.ASM):00358         ; TO DISPLAYING THE HELP SCREEN SO THE BOARD
                      (      FLOODIT.ASM):00359         ; STATE DOESN'T GET CLOBBERED.
                      (      FLOODIT.ASM):00360         ;
                      (      FLOODIT.ASM):00361         ; Y CONTAINS ADDRESS OF OFFSCREEN BUFFER
                      (      FLOODIT.ASM):00362         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
102A                  (      FLOODIT.ASM):00363         SWITCH_BUFFERS:
102A 3412             (      FLOODIT.ASM):00364                 PSHS A,X
102C 8E0400           (      FLOODIT.ASM):00365                 LDX #VRAM
102F A684             (      FLOODIT.ASM):00366         @a      LDA ,X          ;SAVE SCREEN BYTE
1031 B71085           (      FLOODIT.ASM):00367                 STA TEMP
1034 A6A4             (      FLOODIT.ASM):00368                 LDA ,Y          ;LOAD BUFFER BYTE
1036 A784             (      FLOODIT.ASM):00369                 STA ,X          ;COPY BUFFER BYTE TO SCREEN
1038 B61085           (      FLOODIT.ASM):00370                 LDA TEMP        ;GET SCREEN BYTE BACK
103B A7A4             (      FLOODIT.ASM):00371                 STA ,Y          ;COPY SCREEN TO BUF
103D A680             (      FLOODIT.ASM):00372                 LDA ,X+ ; INC X
103F A6A0             (      FLOODIT.ASM):00373                 LDA ,Y+ ; INC Y
1041 8C0600           (      FLOODIT.ASM):00374                 CMPX #VRAM_END ; DONE?
1044 26E9             (      FLOODIT.ASM):00375                 BNE @a
1046 3512             (      FLOODIT.ASM):00376                 PULS X,A
1048 39               (      FLOODIT.ASM):00377                 RTS
                      (      FLOODIT.ASM):00378                 
                      (      FLOODIT.ASM):00379         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00380         ;PLAY_WIN_SND   
                      (      FLOODIT.ASM):00381         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
1049                  (      FLOODIT.ASM):00382         PLAY_WIN_SND:
1049 8606             (      FLOODIT.ASM):00383                 LDA #6
104B                  (      FLOODIT.ASM):00384         @loop
104B 3602             (      FLOODIT.ASM):00385                 PSHU A  ;       SAVE LP COUNTER
104D 108E148B         (      FLOODIT.ASM):00386                 LDY #SCREEN_BUFFER_2
1051 BD102A           (      FLOODIT.ASM):00387                 JSR SWITCH_BUFFERS      
1054 BD105F           (      FLOODIT.ASM):00388                 JSR WASTE_TIME          ; DELAY BETWEEN BLINKS
1057 3702             (      FLOODIT.ASM):00389                 PULU A  ;       RESTORE LP COUNTER
1059 4A               (      FLOODIT.ASM):00390                 DECA
105A 8100             (      FLOODIT.ASM):00391                 CMPA #0
105C 26ED             (      FLOODIT.ASM):00392                 BNE @loop
105E 39               (      FLOODIT.ASM):00393                 RTS
                      (      FLOODIT.ASM):00394                 
                      (      FLOODIT.ASM):00395         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00396         ;       WASTE TIME
                      (      FLOODIT.ASM):00397         ;       AN EMPTY LOOP TO WASTE TIME.  USED FOR
                      (      FLOODIT.ASM):00398         ;       THE BLINKING WHEN THE PLAYER WINS
                      (      FLOODIT.ASM):00399         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
105F                  (      FLOODIT.ASM):00400         WASTE_TIME:
105F 86FF             (      FLOODIT.ASM):00401                 LDA #0xFF
1061 4A               (      FLOODIT.ASM):00402         @lp     DECA    
1062 8100             (      FLOODIT.ASM):00403                 CMPA #0
1064 26FB             (      FLOODIT.ASM):00404                 BNE @lp
1066 39               (      FLOODIT.ASM):00405                 RTS
                      (      FLOODIT.ASM):00406         
                      (      FLOODIT.ASM):00407         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00408         ; STRCPY:
                      (      FLOODIT.ASM):00409         ; SRC AND DEST NEED TO BE STORED IN X,Y
                      (      FLOODIT.ASM):00410         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;     
1067                  (      FLOODIT.ASM):00411         STRCPY:
1067 3402             (      FLOODIT.ASM):00412                 PSHS A
1069 A680             (      FLOODIT.ASM):00413         @a      LDA ,X+
106B 9100             (      FLOODIT.ASM):00414                 CMPA 0
106D 2704             (      FLOODIT.ASM):00415                 BEQ STRCPY_DONE
106F A7A0             (      FLOODIT.ASM):00416                 STA ,Y+
1071 20F6             (      FLOODIT.ASM):00417                 BRA @a
1073                  (      FLOODIT.ASM):00418         STRCPY_DONE:
1073 3502             (      FLOODIT.ASM):00419                 PULS A
1075 39               (      FLOODIT.ASM):00420                 RTS
                      (      FLOODIT.ASM):00421         
                      (      FLOODIT.ASM):00422         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;     
                      (      FLOODIT.ASM):00423         ; program data
                      (      FLOODIT.ASM):00424         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00425         ;       COLOR CODE ARRAY
1076                  (      FLOODIT.ASM):00426         COLORS:
1076 60               (      FLOODIT.ASM):00427                 .db GREEN       ; DARK GREEN
1077 80               (      FLOODIT.ASM):00428                 .db BLACK
1078 CF               (      FLOODIT.ASM):00429                 .db WHITE
1079 AF               (      FLOODIT.ASM):00430                 .db BLUE 
107A 9F               (      FLOODIT.ASM):00431                 .db YELLOW 
107B BF               (      FLOODIT.ASM):00432                 .db RED
                      (      FLOODIT.ASM):00433         ;       RANDOM NUMBER STUFF
107C                  (      FLOODIT.ASM):00434         FIB1:           
107C 01               (      FLOODIT.ASM):00435                 .db 1 ; 55
107D                  (      FLOODIT.ASM):00436         FIB2:
107D 01               (      FLOODIT.ASM):00437                 .db 1 ; 89
107E 00               (      FLOODIT.ASM):00438                 .db 0   ;padding so we can load nextfib into  X (which is 16 bits)
107F                  (      FLOODIT.ASM):00439         NEXTFIB:        
107F 01               (      FLOODIT.ASM):00440                 .db 1 
1080 00               (      FLOODIT.ASM):00441                 .db 0   ;padding so we can load nextfib into  X (which is 16 bits)
1081 00               (      FLOODIT.ASM):00442         OLD_COLOR .db 0 ;       ORIGINAL COLOR OF 0,0 BEFORE BUCKET FILL
1082 00               (      FLOODIT.ASM):00443         NEW_COLOR .db 0 ;       COLOR TO BUCKET FILL WITH
1083 20               (      FLOODIT.ASM):00444         CLR_COLOR .db 32        
1084 00               (      FLOODIT.ASM):00445         TURNS .db 0     ;
1085 00               (      FLOODIT.ASM):00446         TEMP    .db 0
1086 0000             (      FLOODIT.ASM):00447         TEMP_WORD .dw 0
1088 00               (      FLOODIT.ASM):00448         X_COORD .db 0
1089 00               (      FLOODIT.ASM):00449         Y_COORD .db 0
108A                  (      FLOODIT.ASM):00450         LEGEND: 
108A 4D4F564553202020 (      FLOODIT.ASM):00451                 .STRZ "MOVES   /25   H=HELP  BREAK=QUIT"
     2F3235202020483D
     48454C5020204252
     45414B3D51554954
     00
                      (      FLOODIT.ASM):00452         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00453         ;       MARKED_FLAGS: WHERE EACH SQUARE HAS BEEN MARKED
                      (      FLOODIT.ASM):00454         ;   BY THE FLOOD FILL ALGORITHM.
                      (      FLOODIT.ASM):00455         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
10AB                  (      FLOODIT.ASM):00456         FLAGS .RS 480   ;
                      (      FLOODIT.ASM):00457                 
                      (      FLOODIT.ASM):00458         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      (      FLOODIT.ASM):00459         ;HELP SCREEN BUFFER.  THIS SECTION CONTAINS
                      (      FLOODIT.ASM):00460         ;16 LINES OF 32 CHARACTERS.  WHEN THE HELP SCREEN IS
                      (      FLOODIT.ASM):00461         ;DISPLAYED THE CONTENTS OF THIS MEMORY AND THE VRAM
                      (      FLOODIT.ASM):00462         ;WILL BE SWITCHED
                      (      FLOODIT.ASM):00463         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;  
128B                  (      FLOODIT.ASM):00464         SCREEN_BUFFER:
128B                  (      FLOODIT.ASM):00465                 .RS 512
148B                  (      FLOODIT.ASM):00466         SCREEN_BUFFER_2: ;      USED FOR BLACK SCREEN WHEN BLINKING
148B                  (      FLOODIT.ASM):00467                 .RS 512 
168B                  (      FLOODIT.ASM):00468         INSTRUCTIONS1:
168B 544845204F424A45 (      FLOODIT.ASM):00469                 .STRZ "THE OBJECTIVE IS TO MAKE THE "   
     4354495645204953
     20544F204D414B45
     205448452000
16A9                  (      FLOODIT.ASM):00470         INSTRUCTIONS2:
16A9 53435245454E2041 (      FLOODIT.ASM):00471                 .STRZ "SCREEN ALL ONE COLOR.  YOU CAN"
     4C4C204F4E452043
     4F4C4F522E202059
     4F552043414E00
16C8                  (      FLOODIT.ASM):00472         INSTRUCTIONS3:
16C8 444F205448495320 (      FLOODIT.ASM):00473                 .STRZ "DO THIS BY STRATEGICALLY"
     4259205354524154
     45474943414C4C59
     00
16E1                  (      FLOODIT.ASM):00474         INSTRUCTIONS4:
16E1 4255434B45542046 (      FLOODIT.ASM):00475                 .STRZ "BUCKET FILLING THE TOP LEFT"
     494C4C494E472054
     484520544F50204C
     45465400
16FD                  (      FLOODIT.ASM):00476         INSTRUCTIONS5:
16FD 5351554152452E20 (      FLOODIT.ASM):00477                 .STRZ "SQUARE. HOWEVER, YOU ONLY HAVE"
     484F57455645522C
     20594F55204F4E4C
     59204841564500
171C                  (      FLOODIT.ASM):00478         INSTRUCTIONS6:
171C 3235205455524E53 (      FLOODIT.ASM):00479                 .STRZ "25 TURNS, SO CHOOSE YOUR MOVES"
     2C20534F2043484F
     4F534520594F5552
     204D4F56455300
173B                  (      FLOODIT.ASM):00480         INSTRUCTIONS7:
173B 574953454C592E20 (      FLOODIT.ASM):00481                 .STRZ "WISELY. USE THE FOLLOWING KEYS"
     5553452054484520
     464F4C4C4F57494E
     47204B45595300
175A                  (      FLOODIT.ASM):00482         INSTRUCTIONS8:  
175A 58204B4559203D20 (      FLOODIT.ASM):00483                 .STRZ "X KEY = BLACK. B=BLUE"
     424C41434B2E2042
     3D424C554500
1770                  (      FLOODIT.ASM):00484         INSTRUCTIONS9:
1770 57204B4559203D20 (      FLOODIT.ASM):00485                 .STRZ "W KEY = WHITE. C=CYAN"
     57484954452E2043
     3D4359414E00
1786                  (      FLOODIT.ASM):00486         INSTRUCTIONS10:
1786 47204B4559203D20 (      FLOODIT.ASM):00487                 .STRZ "G KEY = GREEN. Y=YELLOW"
     475245454E2E2059
     3D59454C4C4F5700
179E                  (      FLOODIT.ASM):00488         INSTRUCTIONS_11:
179E 5052455353205350 (      FLOODIT.ASM):00489                 .STRZ "PRESS SPACE TO RETURN TO GAME."
     41434520544F2052
     455455524E20544F
     2047414D452E00
                      (      FLOODIT.ASM):00490                 
                      (      FLOODIT.ASM):00491                 END START
